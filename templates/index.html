<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Console Me</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <style>
            .user-message {
                text-align: right;
            }
            .character-message {
                text-align: left;
            }
            .message {
                /* add a light border at bottom*/
                border-bottom: 1px solid #e0e0e0;
            }
        </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row mt-2">
            <div class="col">
                <div class="input-group">
                    <span class="input-group-text">Choose Your Character</span>
                    <select class="form-select" id="character">
                        <option value="1">A knight who just lost his horse</option>
                        <option value="2">A boy who just lost his favourite toy</option>
                        <option value="3">A girl who lost her balloon to the sky and can't get it back.</option>
                        <option value="4">A boy whose ice cream fell off the cone before he could take a bite.</option>
                        <option value="5">A child who built the tallest block tower, only to have it knocked down by a
                            pet.</option>
                        <option value="6">A young wizard whose magic trick didn't go as planned in front of friends.
                        </option>
                        <option value="7">A pirate who can't find where they buried their treasure in the sandbox.
                        </option>
                        <option value="8">A superhero who couldn't fly as high as they wanted to during playtime.
                        </option>
                        <option value="9">A mermaid who lost her special shell necklace during a swim.</option>
                        <option value="10">A young knight who can't find their pretend dragon to save the kingdom.
                        </option>
                        <option value="11">A princess whose fairy garden didn't grow as she expected.</option>
                        <option value="12">A young detective who can't solve the mystery of the missing cookie.</option>
                        <option value="13">A space explorer who's pretend rocket won't take off.</option>
                        <option value="14">An artist who spilled paint on their favorite drawing.</option>
                        <option value="15">A singer who forgot the words to their song during a performance for their
                            family.</option>
                        <option value="16">A young chef whose mud pie didn't turn out as delicious as planned.</option>
                        <option value="17">A child who lost their first tooth but can't find it for the Tooth Fairy.
                        </option>
                        <option value="18">A little racer whose toy car won't go as fast as their friend's.</option>
                        <option value="19">A young gardener whose plant won't sprout, no matter how much they water it.
                        </option>
                        <option value="20">A storybook character who can't remember the way back to their magical land.
                        </option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col">
                <div class="card">
                    <div class="card-body" id="chat-history">
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col">
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="User Input" id="user-input">
                    <button class="btn btn-primary" type="button" id="send">Send</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script
        src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
        crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            var character = 1;
            var chatHistory = [];
            var chatHistoryElement = $('#chat-history');
            var userInput = $('#user-input');
            var sendButton = $('#send');
            var characterSelect = $('#character');
            // on change character, reset chat history and clear chat history element
            characterSelect.on('change', function () {
                character = characterSelect.val();
                chatHistory = [];
                chatHistoryElement.html('');
            });
            sendButton.on('click', onUserInput);
            userInput.on('keypress', function (e) {
                if (e.key === 'Enter') {
                    onUserInput();
                }
            });
            function onUserInput() {
                var userMessage = userInput.val();
                chatHistory.push({
                    role: 'User',
                    content: userMessage
                });
                chatHistoryElement.append('<p class="user-message message">' + userMessage + '</p>');
                userInput.val('');
                // send user input to server
                $.ajax({
                    url: '/userinput',
                    method: 'POST',
                    data: JSON.stringify({
                        character: character,
                        chathistory: chatHistory
                    }),
                    contentType: 'application/json',
                    success: function (response) {
                        chatHistory.push({
                            role: "AI",
                            content: response.message
                        });
                        
                        chatHistoryElement.append('<p class="character-message message">' + response.message + '</p>');

                        let progress = response.progress;
                        $('.progress-bar').css('width', progress*10 + '%');
                    }
                });
            }
            
        });
    </script>
</body>

</html>